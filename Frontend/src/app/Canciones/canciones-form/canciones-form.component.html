<app-header [title]="'Nueva canción'" [showBackButton]="true" [backUrl]="'/albums'" [showMenu]="false"></app-header>

<ion-content class="create-song-page">
  <form [formGroup]="form" (ngSubmit)="guardarDatos()" class="form-wrap" enctype="multipart/form-data" novalidate>

    <ion-card *ngIf="errorMsg" color="danger" class="error-card">
      <ion-card-content class="ion-text-center">
        <ion-icon name="alert-circle-outline"></ion-icon>
        {{ errorMsg }}
        <ion-button fill="clear" size="small" (click)="errorMsg = ''">
          <ion-icon name="close-outline"></ion-icon>
        </ion-button>
      </ion-card-content>
    </ion-card>

    <ion-item>
      <ion-label position="stacked">Nombre</ion-label>
      <ion-input formControlName="nombre" type="text" placeholder="Nombre de la canción"
        [class.ion-invalid]="form.get('nombre')?.invalid && form.get('nombre')?.touched"
        [class.ion-touched]="form.get('nombre')?.touched">
      </ion-input>
      <ion-note slot="error" *ngIf="form.get('nombre')?.invalid && form.get('nombre')?.touched">
        <span *ngIf="form.get('nombre')?.errors?.['required']">El nombre es obligatorio</span>
        <span *ngIf="form.get('nombre')?.errors?.['minlength']">El nombre debe tener al menos 2 caracteres</span>
      </ion-note>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Imagen (portada)</ion-label>
      <input type="file" name="urlImagen" accept="image/*" (change)="onImageChange($event)" />
    </ion-item>

    <ion-item *ngIf="previewUrl">
      <ion-label position="stacked">Vista previa</ion-label>
      <ion-img [src]="previewUrl"></ion-img>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Archivo de audio (.mp3)</ion-label>
      <input type="file" name="urlCancion" accept="audio/*" (change)="onAudioChange($event)" />
      <ion-note *ngIf="selectedAudio" slot="end" class="audio-name">{{ selectedAudio.name }}</ion-note>
    </ion-item>

    <div class="actions">
      <ion-button type="submit" expand="block" [disabled]="form.invalid || !selectedAudio || !selectedImage">
        <ion-icon name="cloud-upload-outline" slot="start"></ion-icon>
        Guardar canción
      </ion-button>

      <ion-button fill="clear" (click)="cancelar()">
        <ion-icon name="arrow-back-outline" slot="start"></ion-icon>
        Cancelar
      </ion-button>
    </div>
  </form>
</ion-content>

<app-footer></app-footer>